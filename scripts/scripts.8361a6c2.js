"use strict";angular.module("usermanagementTestApp",["ngAnimate","ngCookies","ngResource","ngRoute","ngSanitize","ngTouch","ui.bootstrap","oauthio"]).config(["$routeProvider",function(a){a.when("/",{templateUrl:"views/main.html",controller:"MainCtrl"}).when("/getting-started",{templateUrl:"views/getting-started.html",controller:"GettingStartedCtrl"}).when("/signin",{templateUrl:"views/signin.html",controller:"SigninCtrl"}).when("/signup",{templateUrl:"views/signup.html",controller:"SignupCtrl"}).when("/user",{templateUrl:"views/user.html",controller:"UserCtrl"}).when("/logout",{controller:"LogoutCtrl",templateUrl:"views/blank.html"}).otherwise({redirectTo:"/"})}]).run(["$rootScope","User","Materia",function(a,b,c){c.setOAuthdURL("http://iostaging.oauthserver.com"),b.initialize("ZamGgPBUtpLOYv21t-WQAhoULcY"),a.isLogged=b.isLogged(),a.isLogged&&(a.me=b.getIdentity()),a.providersAvailable=["facebook","twitter","google","linkedin","github"]}]),angular.module("usermanagementTestApp").controller("MainCtrl",["$rootScope",function(a){a.menu="home"}]),angular.module("usermanagementTestApp").controller("SignupCtrl",["$rootScope","$scope","$location","$modal","OAuth","User",function(a,b,c,d,e,f){return a.menu="signup",f.isLogged()?c.path("/user"):(b.signup=function(d){b.errorForm=null,f.signup(d).done(function(b){a.isLogged=!0,a.me=b,c.path("/user"),a.$apply()}).fail(function(a){b.errorForm=a,b.$apply()})},void(b.signupSocial=function(g){b.errorSocial=null,e.popup(g).done(function(e){f.signup(e).done(function(b){console.log("signed up",b),a.isLogged=!0,a.me=b,c.path("/user"),a.$apply()}).fail(function(a){a.responseJSON.data.email&&"missing"===a.responseJSON.data.email?d.open({controller:"EmailModalCtrl",templateUrl:"views/modal/email.html",resolve:{data:function(){return e}}}):(b.errorSocial=a,b.$apply())})})}))}]),angular.module("usermanagementTestApp").controller("SigninCtrl",["$rootScope","$scope","$location","$modal","OAuth","User",function(a,b,c,d,e,f){return a.menu="signin",f.isLogged()?c.path("/user"):(b.signin=function(d,e){b.errorEmailPW=null,f.signin(d,e).done(function(b){a.me=b,a.isLogged=!0,c.path("/user"),a.$apply()}).fail(function(a){b.errorEmailPW=a,b.$apply()})},void(b.signinSocial=function(g){b.errorSocial=null,e.popup(g).done(function(e){f.signin(e).done(function(b){a.isLogged=!0,a.me=b,c.path("/user"),a.$apply()}).fail(function(a){a.responseJSON.data.email&&"missing"===a.responseJSON.data.email?d.open({controller:"EmailModalCtrl",templateUrl:"views/modal/email.html",resolve:{data:function(){return e}}}):(b.errorSocial=a,b.$apply())})})}))}]),angular.module("usermanagementTestApp").controller("UserCtrl",["$rootScope","$scope","$location","$modal","User","OAuth",function(a,b,c,d,e,f){return a.menu="user",e.isLogged()?(b.hasProvider=function(b){return a.me.hasProvider(b)},b.toggleProvider=function(c){b.hasProvider(c)?a.me.removeProvider(c):f.popup(c).done(function(c){a.me.addProvider(c).done(function(){b.editableData=a.me.getEditableData(),b.$apply()}).fail(function(a){window.alert("error: "+JSON.stringify(a))}),a.$apply()})},b.select=function(a){var c=d.open({templateUrl:"views/modal/provider.html",controller:"ProviderCtrl",resolve:{provider:function(){return a}}});c.result.then(function(c){"unlink"===c&&b.toggleProvider(a)})},b.editData=function(c){console.log("editData",c);var e=d.open({templateUrl:"views/modal/data.html",controller:"DataModalCtrl",size:"sm",resolve:{data:function(){return{key:c.key,value:c.value,type:typeof c.value}}}});e.result.then(function(){b.editableData=a.me.getEditableData()})},b.removeData=function(c){window.confirm("Are you sure to delete this data?")&&(a.me.data[c.key]=null,a.me.save(),b.editableData=a.me.getEditableData())},a.me.getProviders(),void(b.editableData=a.me.getEditableData())):c.path("/signin")}]),angular.module("usermanagementTestApp").controller("LogoutCtrl",["$rootScope","User","$location",function(a,b,c){b.isLogged()||c.path("/"),a.me=null,a.isLogged=!1,b.getIdentity().logout().done(function(){}).fail(function(a){console.log(a)}),c.path("/")}]),angular.module("usermanagementTestApp").controller("DataModalCtrl",["$rootScope","$scope","$location","$modalInstance","User","data",function(a,b,c,d,e,f){e.isLogged()||(d.dismiss(),c.path("/signin")),b.data=f;var g=f.key,h=function(){var a=b.data.value;if("object"===b.data.type)try{a=JSON.parse(a)}catch(c){return null}else"object"===b.data.type&&(a=parseInt(a));return a};b.save=function(){console.log(g,b.data),""!==g&&g!==b.data.key&&(console.log("edit key"),a.me.data[g]=null);var c=h();return null===c||""===c?window.alert("Error: the value can't be null"):(a.me.data[b.data.key]=c,console.log(a.me.data),a.me.save(),void d.close())},b.close=function(){d.dismiss()}}]),angular.module("usermanagementTestApp").controller("ProviderCtrl",["$scope","$modalInstance","provider",function(a,b,c){console.log(c),a.provider=c,a.unlink=function(){b.close("unlink")},a.close=function(){b.dismiss()}}]),angular.module("usermanagementTestApp").controller("EmailModalCtrl",["$rootScope","$scope","$location","$modalInstance","User","data",function(a,b,c,d,e,f){e.isLogged()&&(d.dismiss(),c.path("/user")),b.emailSetup=function(b){f.email=b,console.log("setup email",f),e.signup(f).done(function(b){a.isLogged=!0,a.me=b,c.path("/user"),d.close(b),a.$apply()}).fail(function(a){window.alert("error:"+JSON.stringify(a))})},b.close=function(){d.dismiss()}}]);